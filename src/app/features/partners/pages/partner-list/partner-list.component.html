<div>
  <app-list-page-header
    [title]="'Partners'"
    [addContent]="'Add partner'"
    [selectedCount]="selectedPartners.length"
    (bulkDelete)="confirmBulkDelete()"
    (add)="navigateToCreate()"
  ></app-list-page-header>

  @if (error$ | async; as error) {
  <div class="error-container">
    <div class="error-message">
      <span class="error-icon">⚠️</span>
      <span class="error-text">{{
        error.message || 'Failed to load partners. Please try again.'
      }}</span>
      <button class="btn btn-secondary btn-retry" (click)="retryLoadPartners()">Retry</button>
    </div>
  </div>
  }

  <div class="partners-table">
    <app-data-table
      [data]="partners"
      [columns]="columns"
      [actions]="actions"
      [loading]="(loading$ | async)!"
      [paginator]="true"
      [rows]="(pageSize$ | async) || 10"
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      [totalRecords]="(totalRecords$ | async) || 0"
      [currentPage]="(currentPage$ | async) || 1"
      [pageSize]="(pageSize$ | async) || 10"
      [height]="'calc(100vh - 200px)'"
      [showActions]="true"
      [globalFilterFields]="['name', 'phoneNumber', 'type', 'description']"
      [selectionMode]="'multiple'"
      [dataKey]="'_id'"
      [showFilters]="true"
      (pageChange)="onPageChange($event)"
      (rowSelect)="onRowSelect($event)"
      (rowUnselect)="onRowSelect($event)"
      (filterChange)="onFilterChange($event)"
    >
      <ng-template appCell="type" let-value let-rowData="rowData">
        <app-status-badge [value]="value"></app-status-badge>
      </ng-template>
    </app-data-table>
  </div>

  <app-confirm-dialog
    [isOpen]="showDeleteDialog"
    title="Delete Partner"
    [message]="
      partnerToDelete ? 'Are you sure you want to delete ' + partnerToDelete.name + '?' : ''
    "
    warningMessage="This action cannot be undone."
    confirmText="Delete"
    cancelText="Cancel"
    confirmButtonClass="btn-danger"
    (confirm)="deletePartner()"
    (cancel)="cancelDelete()"
  ></app-confirm-dialog>

  <app-confirm-dialog
    [isOpen]="showBulkDeleteDialog"
    title="Delete Multiple Partners"
    [message]="
      'Are you sure you want to delete ' +
      selectedPartners.length +
      ' partner' +
      (selectedPartners.length > 1 ? 's' : '') +
      '?'
    "
    warningMessage="This action cannot be undone."
    confirmText="Delete All"
    cancelText="Cancel"
    confirmButtonClass="btn-danger"
    (confirm)="bulkDeletePartners()"
    (cancel)="cancelBulkDelete()"
  ></app-confirm-dialog>
</div>
