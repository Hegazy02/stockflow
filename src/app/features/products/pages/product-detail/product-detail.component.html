<!-- Loading State -->
@if (loading$ | async) {
<div class="loading-container">
  <div class="loading-spinner"></div>
  <p>Loading product details...</p>
</div>
} @else if (product$ | async; as product) {
<!-- Product Content -->
<app-details-page-header
  (back)="navigateToList()"
  (edit)="navigateToEdit()"
  (delete)="confirmDelete()"
>
</app-details-page-header>

<div class="product-card">
  <div class="product-header">
    <h1>{{ product.name }}</h1>
    <span class="sku-badge">{{ product.sku }}</span>
  </div>

  <div class="product-details">
    <div class="detail-section">
      <h2>Product Information</h2>
      <div class="detail-grid">
        <div class="detail-item">
          <span class="label">Quantity:</span>
          <span class="value">{{ product.quantity }}</span>
        </div>
        <div class="detail-item">
          <span class="label">SKU:</span>
          <span class="value">{{ product.sku }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Category:</span>
          <span class="value">{{ product.category.name }}</span>
        </div>

        <div class="detail-item">
          <span class="label">Created:</span>
          <span class="value">{{ product.createdAt | date : 'medium' }}</span>
        </div>

        <div class="detail-item">
          <span class="label">Last Updated:</span>
          <span class="value">{{ product.updatedAt | date : 'medium' }}</span>
        </div>
      </div>
    </div>

    <div class="detail-section">
      <h2>Description</h2>
      <p class="description">{{ product.description }}</p>
    </div>

    <div class="detail-section">
      <h2>Stock Levels</h2>

      @if (stockLevels$ | async; as stockLevels) { @if (stockLevels.length > 0) {
      <div class="stock-container">
        <div class="total-stock">
          <span class="total-label">Total Stock:</span>
          <span class="total-value">{{ totalStock$ | async }} units</span>
        </div>

        <div class="stock-table">
          <table>
            <thead>
              <tr>
                <th>Warehouse</th>
                <th>Location</th>
                <th>Quantity</th>
                <th>Last Updated</th>
              </tr>
            </thead>
            <tbody>
              @for (stock of stockLevels; track stock.warehouseId) {
              <tr [class.low-stock]="stock.quantity < 10">
                <td class="warehouse-name">
                  {{ stock.warehouse?.title || 'Unknown Warehouse' }}
                </td>
                <td class="warehouse-location">
                  {{ stock.warehouse?.location || 'N/A' }}
                </td>
                <td class="quantity">
                  <span class="quantity-badge" [class.low]="stock.quantity < 10">
                    {{ stock.quantity }}
                  </span>
                </td>
                <td class="last-updated">
                  {{ stock.lastUpdated | date : 'short' }}
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
      } @else {
      <div class="stock-info empty">
        <div class="empty-icon">
          <lucide-icon [img]="Package" [size]="48"></lucide-icon>
        </div>
        <p class="info-message">No stock available for this product yet.</p>
        <p class="placeholder-text">Add stock to warehouses to see inventory levels here.</p>
      </div>
      } }
    </div>
  </div>
</div>

<!-- Delete Confirmation Dialog -->
<app-confirm-dialog
  [isOpen]="showDeleteConfirm"
  title="Delete Product"
  [message]="'Are you sure you want to delete ' + productName + '?'"
  warningMessage="This action cannot be undone."
  confirmText="Delete"
  cancelText="Cancel"
  confirmButtonClass="btn-danger"
  (confirm)="deleteProduct()"
  (cancel)="cancelDelete()"
></app-confirm-dialog>
} @else {
<!-- Not Found State -->
<div class="not-found">
  <h2>Product Not Found</h2>
  <p>The product you're looking for doesn't exist.</p>
  <button class="btn-primary" (click)="navigateToList()">Back to Products</button>
</div>
}
