<div *ngIf="product$ | async as product">
  <div class="header">
    <button class="btn-back" (click)="navigateToList()">
      <lucide-icon [img]="ArrowLeft" [size]="18"></lucide-icon>
      <span>Back to Products</span>
    </button>
    <div class="actions">
      <button class="btn-secondary" (click)="navigateToEdit()">
        <lucide-icon [img]="Edit" [size]="18"></lucide-icon>
        <span>Edit</span>
      </button>
      <button class="btn-danger" (click)="confirmDelete()">
        <lucide-icon [img]="Trash2" [size]="18"></lucide-icon>
        <span>Delete</span>
      </button>
    </div>
  </div>

  <div class="product-card">
    <div class="product-header">
      <h1>{{ product.name }}</h1>
      <span class="sku-badge">{{ product.sku }}</span>
    </div>

    <div class="product-details">
      <div class="detail-section">
        <h2>Product Information</h2>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="label">Category:</span>
            <span class="value">{{ product.category.name }}</span>
          </div>
          <div class="detail-item">
            <span class="label">SKU:</span>
            <span class="value">{{ product.sku }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Created:</span>
            <span class="value">{{ product.createdAt | date : 'medium' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Last Updated:</span>
            <span class="value">{{ product.updatedAt | date : 'medium' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h2>Description</h2>
        <p class="description">{{ product.description }}</p>
      </div>

      <div class="detail-section">
        <h2>Stock Levels</h2>

        <!-- Display when stock data is available -->
        <ng-container *ngIf="stockLevels$ | async as stockLevels">
          <div *ngIf="stockLevels.length > 0; else noStock" class="stock-container">
            <div class="total-stock">
              <span class="total-label">Total Stock:</span>
              <span class="total-value">{{ totalStock$ | async }} units</span>
            </div>

            <div class="stock-table">
              <table>
                <thead>
                  <tr>
                    <th>Warehouse</th>
                    <th>Location</th>
                    <th>Quantity</th>
                    <th>Last Updated</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let stock of stockLevels" [class.low-stock]="stock.quantity < 10">
                    <td class="warehouse-name">
                      {{ stock.warehouse?.name || 'Unknown Warehouse' }}
                    </td>
                    <td class="warehouse-location">
                      {{ stock.warehouse?.location || 'N/A' }}
                    </td>
                    <td class="quantity">
                      <span class="quantity-badge" [class.low]="stock.quantity < 10">
                        {{ stock.quantity }}
                      </span>
                    </td>
                    <td class="last-updated">
                      {{ stock.lastUpdated | date : 'short' }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <ng-template #noStock>
            <div class="stock-info empty">
              <div class="empty-icon">
                <lucide-icon [img]="Package" [size]="48"></lucide-icon>
              </div>
              <p class="info-message">No stock available for this product yet.</p>
              <p class="placeholder-text">Add stock to warehouses to see inventory levels here.</p>
            </div>
          </ng-template>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Dialog -->
  <app-confirm-dialog
    [isOpen]="showDeleteConfirm"
    title="Delete Product"
    [message]="'Are you sure you want to delete ' + productName + '?'"
    warningMessage="This action cannot be undone."
    confirmText="Delete"
    cancelText="Cancel"
    confirmButtonClass="btn-danger"
    (confirm)="deleteProduct()"
    (cancel)="cancelDelete()"
  ></app-confirm-dialog>
</div>

<div class="not-found" *ngIf="!(product$ | async)">
  <h2>Product Not Found</h2>
  <p>The product you're looking for doesn't exist.</p>
  <button class="btn-primary" (click)="navigateToList()">Back to Products</button>
</div>
