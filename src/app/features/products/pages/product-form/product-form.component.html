<div >
  <div class="form-header">
    <button type="button" class="btn-back" (click)="onCancel()">
      <lucide-icon [img]="ArrowLeft" [size]="18"></lucide-icon>
      <span>Back to Products</span>
    </button>
    <h1>{{ isEditMode ? 'Edit Product' : 'Create New Product' }}</h1>
  </div>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
    <app-form-input
      label="Product Name"
      placeholder="Enter product name"
      formControlName="name"
      [required]="true"
      [minLength]="2"
    ></app-form-input>

    <app-form-input
      label="SKU"
      placeholder="e.g., PROD-001"
      formControlName="sku"
      [required]="true"
      helpText="Use uppercase letters, numbers, and hyphens only"
    ></app-form-input>

    <div class="form-field">
      <label for="category">
        Category <span class="required">*</span>
      </label>
      
      <app-dropdown
        id="category"
        formControlName="categoryId"
        [options]="(categories$ | async) || []"
        optionLabel="name"
        optionValue="_id"
        placeholder="Select a category"
        [filter]="true"
        [loading]="(categoriesLoading$ | async) || false"
        [class.invalid]="isFieldInvalid('category')"
      ></app-dropdown>

      @if (isFieldInvalid('category')) {
        <small class="error-message">{{ getErrorMessage('category') }}</small>
      }
      
      @if (categoriesError$ | async; as error) {
        <small class="error-message">{{ error.message }}</small>
      }
    </div>

    <app-form-input
      label="Description"
      placeholder="Enter product description"
      type="textarea"
      formControlName="description"
      [rows]="4"
    ></app-form-input>

    <div class="form-actions">
      <button type="button" class=" btn-secondary" (click)="onCancel()">
        <lucide-icon [img]="X" [size]="18"></lucide-icon>
        <span>Cancel</span>
      </button>
      <button type="submit" class="btn-primary" [disabled]="productForm.invalid">
        <lucide-icon [img]="Save" [size]="18"></lucide-icon>
        <span>{{ isEditMode ? 'Update Product' : 'Create Product' }}</span>
      </button>
    </div>
  </form>
</div>
