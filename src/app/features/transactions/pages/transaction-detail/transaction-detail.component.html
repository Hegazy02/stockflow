<div class="detail-container">
  @if (loading$ | async) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Loading transaction...</p>
  </div>
  } @else if (transaction$ | async; as transaction) {
  <app-details-page-header
    (back)="onBack()"
    (edit)="onEdit()"
    (delete)="confirmDelete()"
    [hasEdit]="false"
  >
  </app-details-page-header>

  <div class="detail-content">
    <div class="info-card">
      <h2>Transaction Information</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Transaction Type</label>
          <app-status-badge [value]="transaction.transactionType"></app-status-badge>
        </div>

        <div class="info-item">
          <label>Balance</label>
          <p>{{ transaction.balance }}</p>
        </div>
        <div class="info-item">
          <label>Paid</label>
          <p>{{ transaction.paid }}</p>
        </div>
        <div class="info-item">
          <label>Left</label>
          <p>{{ transaction.left }}</p>
        </div>
        <div class="info-item">
          <label>Partner</label>
          <p>{{ transaction.partner?.name || 'N/A' }}</p>
        </div>

        <div class="info-item">
          <label>Partner Type</label>
          <p>{{ transaction.partner?.type || 'N/A' }}</p>
        </div>
        <div class="info-item">
          <label>Created At</label>
          <p>{{ transaction.createdAt | date : 'medium' }}</p>
        </div>
        <div class="info-item">
          <label>SERIAL NUMBER</label>
          <p>{{ transaction?.serialNumber || 'N/A' }}</p>
        </div>
        <div class="info-item full-width">
          <label>Note</label>
          <p>{{ transaction.note || 'No note provided' }}</p>
        </div>

        <!-- <div class="info-item">
          <label>Updated At</label>
          <p>{{ transaction.updatedAt | date : 'medium' }}</p>
          -->
      </div>
    </div>
    @if
    (transaction.transactionType==TransactionType.SALES||transaction.transactionType==TransactionType.PURCHASES)
    {
    <div class="info-card">
      <h2>Products ({{ transaction.products?.length }})</h2>
      <div class="products-table">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Product Name</th>
              <th>SKU</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            @for (product of transaction.products; track product.productId; let i = $index) {
            <tr>
              <td>{{ i + 1 }}</td>
              <td>{{ product.name || product.product?.name || product.productId }}</td>
              <td>{{ product.sku || product.product?.sku || 'N/A' }}</td>
              <td class="price">
                {{
                  transaction.transactionType == TransactionType.SALES
                    ? product.sellingPrice
                    : product.costPrice
                }}
              </td>
              <td class="">{{ product.quantity }}</td>
              <td class="quantity">
                {{
                  product.quantity *
                    (transaction.transactionType == TransactionType.SALES
                      ? product.sellingPrice
                      : product.costPrice)
                }}
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }
  </div>

  <app-confirm-dialog
    [isOpen]="showDeleteDialog"
    title="Delete Transaction"
    message="Are you sure you want to delete this transaction?"
    warningMessage="This action cannot be undone."
    confirmText="Delete"
    cancelText="Cancel"
    confirmButtonClass="btn-danger"
    (confirm)="onDelete()"
    (cancel)="cancelDelete()"
  ></app-confirm-dialog>
  } @else {
  <div class="not-found">
    <h2>Transaction Not Found</h2>
    <p>The transaction you're looking for doesn't exist.</p>
    <button class="btn btn-primary" (click)="onBack()">Back to Transactions</button>
  </div>
  }
</div>
