<div class="table-container">
  <p-table
    [value]="data"
    [columns]="columns"
    [paginator]="paginator"
    [rows]="rows"
    [rowsPerPageOptions]="rowsPerPageOptions"
    [loading]="loading"
    [globalFilterFields]="globalFilterFields"
    [dataKey]="dataKey"
    [selectionMode]="selectionMode"
    [(selection)]="selectedRows"
    (onRowSelect)="onRowSelect($event)"
    (onRowUnselect)="onRowUnselect($event)"
    styleClass="p-datatable-sm"
    [tableStyle]="{ 'min-width': '50rem' }"
  >
    <!-- Table Header -->
    <ng-template pTemplate="header">
      <tr>
        <!-- Selection Column -->
        @if (selectionMode === 'multiple') {
        <th style="width: 3rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        }

        <!-- Data Columns -->
        @for (col of columns; track col.field) {
        <th [pSortableColumn]="col.sortable ? col.field : undefined" [style.width]="col.width">
          {{ col.header }}
          @if (col.sortable) {
          <p-sortIcon [field]="col.field"></p-sortIcon>
          }
        </th>
        }

        <!-- Actions Column -->
        @if (showActions && actions.length > 0) {
        <th style="width: 150px">Actions</th>
        }
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-rowData>
      <tr>
        <!-- Selection Column -->
        @if (selectionMode === 'multiple') {
        <td>
          <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
        </td>
        }

        <!-- Data Columns -->
        @for (col of columns; track col.field) {
        <td>
          {{ formatCellValue(rowData[col.field], col) }}
        </td>
        }

        <!-- Actions Column -->
        @if (showActions && actions.length > 0) {
        <td>
          <div class="action-buttons">
            @for (action of actions; track action.label) {
            <button
              class="action-btn"
              [class]="action.styleClass"
              (click)="executeAction(action, rowData)"
              [title]="action.label"
            >
              <lucide-icon [img]="action.icon" [size]="16"></lucide-icon>
            </button>
            }
          </div>
        </td>
        }
      </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td
          [attr.colspan]="
            columns.length + (showActions ? 1 : 0) + (selectionMode === 'multiple' ? 1 : 0)
          "
        >
          <div class="empty-message">
            <p>No records found</p>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Loading -->
    <ng-template pTemplate="loadingbody">
      <tr>
        <td
          [attr.colspan]="
            columns.length + (showActions ? 1 : 0) + (selectionMode === 'multiple' ? 1 : 0)
          "
        >
          <div class="loading-message">
            <p>Loading data...</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
